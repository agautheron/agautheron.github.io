---
title: 'MRI Reconstruction in  Cambridge'
date: 2019-06-01
permalink: /posts/2019/06/blog-post-1/
tags:
  - Cambridge
  - MRI
---

During summer 2019, I was invited in the Department of Applied Mathematics and Theoretical Physics of the University of Cambridge. I worked with [Noemie Debroux](https://sites.google.com/view/noemiedebroux/) and [Angelica I. Aviles-Rivero](https://angelicaiaviles.wordpress.com/) on MRI reconstruction.

# The Project

Due to technical difficulties, MRI data are incomplete, thus to recover a full image of the patient, we have to develop technique to extrapolate from this set of incomplete data. If you try to reconstruct the MRI images by inverse Fourier transform you get this result:

| ![Reference frame](https://tschmoderer.github.io/images/blogs/2019_06_cambridge/reference_cardiac.jpg) |![IFFT frame](https://tschmoderer.github.io/images/blogs/2019_06_cambridge/direct_reco_cardiac.jpg) |
|:--:|:--:|
| **Reference images** | **Inverse Fourier Transform reconstruction** |

This method can be seen as a minimization of the least square problem

$$
E(\mathbf{m}) = \int_0^T \frac{1}{2} \|K\mathbf{m} - f\|_2^2\ dt
$$

where we have,

* $\mathbf{m}$: The Image sequence we want to reconstruct,
* $K$ : The Fourier undersampling operator,
* $f$ : The data we possess,

The reconstruction is not that bad (in fact $\text{ssim} = XX$) clearly imperfect. We can improve this result by adding prior knowlegde of the data, such as sparse representation.

## Traditional methods

We know that MRI images are sparse in the Wavelet domain. Moreover if we assume that MRI images are piecewise constant, traditional variational methods tend to minimize the following energy

$$
E(\mathbf{m}) = \int_0^T \frac{1}{2}\|K\mathbf{m}-f\|_2^2 + \lambda_1\|\nabla \mathbf{m}\|_1+\lambda_2\|\Psi\mathbf{m}\|_1\ dt
$$

Hence this energy try to minimize the fidelity of the reconstruction with a constraint on the TV norm of each images and the sparsity of the images in the wavelet domain. This method improve the result on only inverse Fourier transform reconstruction.

|![TV-L1 frame](https://tschmoderer.github.io/images/blogs/2019_06_cambridge/tvl1_cardiac.jpg) |
|:--:|
| **Reconstruction by TV-L1 method with $\lambda_1=$ and $\lambda_2=$ **|

## Improvement

We can improve this reconstruction by using the temporal information. In deed, MRI data came from a sequence so there is a correlation between two consecutive reconstructed frames. This correlation is given by the optical flow. Assume we have a method to reconstruct the optical flow (such as TV-L1 method), we propose to minimize the following energy:

$$
E(\mathbf{m}) = \int_0^T \frac{1}{2}\|K\mathbf{m}-f\|_2^2 + \lambda_1\|\nabla \mathbf{m}\|_1+\lambda_2\|\Psi\mathbf{m}\|_1 + \lambda_3\left\| \frac{\partial \mathbf{m}}{\partial t} + \nabla \mathbf{m}\cdot\mathbf{u}\right\|_1\ dt
$$

### Algorithm

We can describe the method tho minize this energy. The method is based on Chambolle & Pock [Algorithm](b1639827@urhen.com). The algorithm is a primal dual iteration, let $\mathbf{y}$ be the collection of dual variables.

Chambolle Algorithm solve the following saddle point problem with $C=\begin{pmatrix}K \\ \nabla \\ \Psi \\ F\end{pmatrix}$ and $F\mathbf{m} = \frac{\partial \mathbf{m}}{\partial t} + \nabla \mathbf{m}\cdot\mathbf{u}$.

$$
\arg\min_{\mathbf{m}}\arg\max_{\mathbf{y}} \left\langle C\mathbf{m},\mathbf{y} \right\rangle - E^{\star}(\mathbf{y})
$$

The iteration proceed as follow, 

$$ \begin{align} A & = B \\ & = C \end{align} $$

$$
y_1^{n+1} = \frac{y_1^n+\sigma K\bar{\mathbf{m}}^n-\sigma f}{2\sigma +1} \\
y_2^{n+1} = \pi_{\lambda_1}
$$

## Our contribution
The main idea of the project was to combine MRI reconstruction with sparse representation of the optical flow. 

# Tourism
During this two month, I enjoyed walking in the old street of Cambridge. It was impressive to be in the city where DNA was discover,

| ![Mathematical Bridge](https://tschmoderer.github.io/images/blogs/2019_06_cambridge/math_bridge.jpg) |
|:--:|
| **Mathematical Bridge** |
